<?xml version="1.0" encoding="UTF-8"?>
<config>
  <connect host="atk.alvetk.ru" js_wsocket="&lt;script type=\&quot;text\/javascript\&quot;&gt;\n\t\/\/ Не забудьте указать данные для авторизации\n\tconst URL = 'ws:\/\/username:password@atk.onpoz.ru\/channel';\n\n\tlet ask_ws = function(msg, callbk) {\n\t\t\tif (typeof(msg) === 'object') msg = JSON.stringify(msg);\n\t\t\tlet agent = new WebSocket(URL);\n\t\t\tagent.onerror = function(evt) {\n\t\t\t\t\t\t\t\t\t\tconsole.log('WS Closed on error: ', evt);\n\t\t\t\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t\t\t\t};\n\t\t\tagent.onclose = function(evt) {\n\t\t\t\t\t\t\t\t\t\tif ( evt.code != 1005 ) console.log('Something wrong with WS')\n\t\t\t\t\t\t\t\t\t};\n\t\t\tagent.onopen = function() {\n\t\t\t\t\t\t\t\t\t\tthis.send( msg );\n\t\t\t\t\t\t\t\t\t};\n\t\t\tagent.onmessage = function(evt) {\n\t\t\t\t\t\tlet msg = evt.data;\n\t\t\t\t\t\tif ( msg.match(\/^[\\{\\[].+[\\]\\}]$\/) ) {\n\t\t\t\t\t\t\ttry { msg = JSON.parse( evt.data );\n\t\t\t\t\t\t\t} catch(e) { console.log(e) };\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( callbk ) callbk(msg);\n\t\t\t\t\t\tthis.close();\n\t\t\t\t\t};\n\t\t};\n\n\tlet whenGotResponse = function(data) {\n\t\t\tconsole.log(data);\n\t\t\tconsole.log('При получении ответа он будет передан в функцию');\n\t\t};\n\n\tdocument.addEventListener('DOMContentLoaded', function(e) {\n\t\t\t\/\/ Подразумевается, что в странице есть элемент класса '.wsquery' для отправки ws-запроса\n\t\t\tdocument.querySelector('.wsquery').onclick = function(e) {\n\t\t\t\t\tlet msg = {'description':'В этой переменной можно текст либо объект'};\n\t\t\t\t\task_ws( msg, whenGotResponse );\n\t\t\t\t};\n\t\t});\n&lt;\/script&gt;\n" ping_msg="GET \/ HTTP\/1.0\n\n" port="25200" />
</config>
